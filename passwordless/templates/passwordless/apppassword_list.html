{% extends 'base.html' %}

{% block header %}
App Passwords
{% endblock header %}

{% block content %}
<p>
App Passwords allow you to access AK Writers services -- such as the chat server
-- through apps such as Pidgin or Adium. We'll generate the app passwords for
you, and you won't need to remember them -- your app will do that for you!
</p>
<table class="table table-hover">
	<tr>
		<th>Name</th>
		<th>Created</th>
		<th>Last Used</th>
		<th>Access</th>
	</tr>
	{% now 'Ymd' as today %}
	{% for password in password_list %}
	<tr>
		<td>{{ password.name }}</td>
		{% if password.created_on|date:'Ymd' == today %}
		<td>{{ password.created_on|time:'g:i A' }}</td>
		{% else %}
		<td>{{ password.created_on|date:'M j, Y' }}</td>
		{% endif %}
		{% if not password.last_used %}
		<td>--</td>
		{% elif password.last_used|date:'Ymd' == today %}
		<td>{{ password.last_used|time:'g:i A' }}</td>
		{% else %}
		<td>{{ password.last_used|date:'M j, Y' }}</td>
		{% endif %}
		<td><button class="btn btn-danger btn-sm" type="button" data-toggle="modal" data-target="#revoke_modal">Revoke</button></td>
	</tr>
	{% endfor %}
	<tr>
		<td colspan="4">
			<div class="row">
				<div class="col-md-6">
					<div class="input-group">
						<input id="new_password_name" class="form-control" type="text" placeholder="e.g. Pidgin on my Laptop" onkeyup="enableGenerate();">
						<span class="input-group-btn">
							<button id="generate_new_password" class="btn btn-success" type="button" disabled>Generate New Password</button>
						</span>
					</div>
				</div>
			</div>
		</td>
</table>

<!-- Revoke Modal -->
<div class="modal fade" id="revoke_modal" tabindex="-1" role="dialog" aria-labelledby="revoke_modal_label">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="revoke_modal_label">Revoke Password</h4>
			</div>
			<div class="modal-body">
				Are you really sure you want to revoke this password? The app using it will be unable to connect until you generate a new one.
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-danger">Revoke</button>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
function enableGenerate()
{
	if($('#new_password_name').val())
	{
		$('#generate_new_password').removeAttr("disabled")
	} else {
		$('#generate_new_password').attr("disabled", "disabled")
	}
}
</script>
{% endblock content %}
